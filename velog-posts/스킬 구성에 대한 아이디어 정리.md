<p>전투를 설계하고 스킬 구조를 설계할때 마다 항상 고민을 하는 것 같다.
그래서 이번 기회에 한번 어떤 아키텍처를 추구해야할지 정리 해보려한다.</p>
<h2 id="정리">정리</h2>
<h3 id="1-빠른-수정에-자유롭고-단일책임-원칙-준수">1. 빠른 수정에 자유롭고, 단일책임 원칙 준수</h3>
<p>스킬을 제작하고 만약 기능에 대한 변경이 필요할 때 빠르게 변경이 가능해야하고
해당 스킬데이터만을 수정한 뒤 다른 코드에서 문제가 발생하지 않는 구조로 짜야한다.</p>
<ol>
<li><p>스킬을 SO로 하고 SerializeReference 어트리뷰트와 커스텀 에디터로 
List로 Effect들을 SO에 세팅 가능하도록 한다.
Effect 들은 추상화 클래스를 상속받아 구성한다. (넉백, 틱뎀, 힐 등등)</p>
</li>
<li><p>스킬SO가 Effect List를 가지는 것이 아니라 Factory List를 가지게 하고
Effect를 struct로 설계하여 Effect를 적용시킬 때 Factory에서 Create하여 실행하도록 구성하였을 때 유연성이 높아질 것 같기애 고려해봐야할 것 같다.</p>
</li>
</ol>
<p><img alt="" src="https://velog.velcdn.com/images/hsd0604/post/dce168f6-f7f0-45d5-b105-a7cee7ce06b2/image.png" /></p>
<h3 id="2-스킬-발동-조건과-발동-input도-effect처럼-분리">2. 스킬 발동 조건과 발동 Input도 Effect처럼 분리</h3>
<ol>
<li><p>스킬을 꾹눌렀을 때 사용, 눌렀을 때 바로 사용, 누르고 있을 때 사용 처럼
스킬을 시전하는 방법이 다양하기 때문에 이 부분을 따로 분리하여 Effect와 같이 주입식으로
설계함으로써 실제 이 기능들을 적용하는 코드의 가독성이 좋아지는 효과를 기대하고 있다.</p>
</li>
<li><p>스킬의 판단 범위, 투사체 또한 간단한 주입식으로 할 수 있도록 하고 
Effect와 비슷한 형태로 CustomEditor 및 SerializeReference를 사용하여 인스펙터 주입으로 한다.</p>
</li>
</ol>
<h3 id="3-필터-처리를-if-else보단-combinator로-구성하기">3. 필터 처리를 if else보단 Combinator로 구성하기</h3>
<ol>
<li>if else로 충분히 처리 가능하겠지만 이렇게 처리하게 되면 복잡해질수록 코드 가독성이 점점 떨어지는 문제가 발생하기 때문에 작은 단위의 메서드를 합쳐 보다 가독성있는 bool 값을 반환하는 Combinator를 구성함으로써 가독성을 높이는 결과를 기대할 수 있다.
핵심 아이디어 로는 struct기반으로 설계하여 GC 부하를 줄이도록 하고 
[MethodImpl(MethodImplOptions.AggressiveInlining)] 어트리뷰트를 활용하여
오버헤드를 줄이는 전략을 가져가는게 좋을 것 같다.</li>
</ol>
<h3 id="4-이벤트-연결">4. 이벤트 연결</h3>
<ol>
<li>스킬이 실행되는 조건 등에도 당연히 delegate 가 필요한 경우가 존재한다.
그래서 EventBus를 구성하여 관리하거나 아니면 SO에 이벤트들을 적제하여 사용하는 방안도 
생각해봐야겠다.</li>
</ol>
<h3 id="추가">추가</h3>
<p>추가로 인터페이스를 적극 활용해보아야 겠다. IEffect, IFactory, ITargeting, IEvent 등</p>
<p>또한 추가적인 확장성까지 고려해야 할 것 같다.</p>
<p>예를 들어 Effect라는 클래스를 Interface기반으로 설계해서 스킬 이외의 다른
버프, 디버프와 같은 추가적인 기능에도 사용가능 하도록 설계되어야 한다.</p>